<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="google-site-verification" content="urlI98uR-E1CxkgmtiHXUTowCXbv8VdQUiA1PkeetNk" /> 
<!--
Copyright (c)  2012   John King
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->



<title>Canvas Draw</title>
<style type="text/css">
div, button {
	position: absolute;
}


img.marker {
	position:absolute;
	}
	
#background {
	top:0;
	left:0;
	width: 100%;
	height:100%;
	overflow:auto;
	background-color:#999999;
	visibility:hidden;

}

#drawarea {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	visibility:hidden;
}

#canvasarea {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	background-color:white;
	border:solid black 1px;
	visibility:hidden;
}

#canvasframe {
	top:52px;
	left:0px;
	width: 100%;
	height:80%;
	border:solid black 1px;
	visibility:hidden;
}

#bodydiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;


	overflow:auto;
}

#filmbodydiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	visibility:hidden;

}

#filmdivhandle {
	width:49px;
	height:46px;
	filter:alpha(opacity=50);
	opacity:0.5;
	visibility:hidden;
	background-image:url(assets/filmove.png);

}

#animationdiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;

	visibility:hidden;
}

#canvasdiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	background-color:transparent;
}

.dialoguebox {
	border: 1px solid #000000;
	border-top:1px solid #000000;
	visibility:hidden;
	z-index:5;
}

.head {
	background-color: #000000;
	cursor:default;
	color: #FFFFFF;
	font-size:12pt;
	font-weight: bold;
	height:25px;
	width: 100%;
}

.head img {
	float:right;
}

.content {
	background-color: #DDDDDD;
	width: 100%;
	top:25px;
}

.content img {
	float:right;
}

.content input {
	position:relative;
	text-align:right;
	margin-left:2px;

}

.content p.justtext {
	position:relative;
	left:5px;
}

.content p.text_input label, p.select_input label{
	position:relative;
	left:5px;
}

.content p.text_input input {
	left:30px;
}

.content p.text_input .title {
	position:relative;
	left:25px;
	text-align: left;
}

.content p.text_input span {
	position:relative;
	left:40px;
}

.content p.select_input select{
	position:relative;
	left:10px;
	width:70px;
}

.content p.chk_radio_input input{
	left:5px;
}

.content p.chk_radio_input label {
	position:relative;
	left:10px;
}

.content p.check_input input{
	left:5px;
}

.content p.check_input label {
	position:relative;
	left:10px;
}

.content div {
	width:100%;
	height:25px;
	background-color:#FFFFFF;
	font-weight: bold;
}

.dragger {
	top:-10px;
	left:-10px;
	visibility:hidden;
	z-index: 15;
	cursor: pointer;
}

#spritediv {
	top:2px;
	left:2px;
	width:96%;
	height:75px;
	background-color: #DDDDDD;
}

#spritedropel {
	top:0px;
	left:0px;
	width:50%;
	height:20px;
	border:solid 1px black;
	text-align: center;
}

#spritedroptrack {
	top:0px;
	left:50%;
	width:50%;
	height:20px;
	border:solid 1px black;
	text-align: center;
}

#eldrop {
	top:20px;
	left:0px;
	width:50%;
	height:40px;
	border:solid 1px black;
	text-align: center;
}

#trackdrop {
	top:20px;
	left:50%;
	width:50%;
	height:40px;
	border:solid 1px black;
	text-align: center;
}

#spritechoice {
	top:65px;
	left:2px;
	width:96%;
	height:90px;
	background-color: #DDDDDD;
}

.elementsbox {
	border: 1px solid #000000;
	visibility:hidden;
	background-color:#FFFFFF;
	z-index:4;
}

.pathtext {
	padding-left: 2px;
	font-size: 8pt;
}

.white {
	top:25px;
	width:100%;
	height:25px;
	background-color:#FFFFFF;
}

.newbuild40 {
	top:25px;
	width:100%;
	height:25px;
	background-color:#000000;
	font-weight: bold;
	font-size:12pt;
	color: #FFFFFF;
	opacity:0.20;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=20)";
    filter:alpha(opacity=20);
	cursor:default;
}

.newbuild80 {
	top:25px;
	width:100%;
	height:25px;
	background-color:#000000;
	font-weight: bold;
	font-size:12pt;
	color: #FFFFFF;
	opacity:0.50;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=50)";
    filter:alpha(opacity=50);
	cursor:default;
	text-decoration:underline;
}

.filmline {
	top:25px;
	width:100%;
	height:25px;
	cursor:default;
}

#flellistholder {
	width:100px;
	background-color:#FFFFFF;
	overflow:hidden;
	border:1px solid black;
	cursor:default;
}
#flelorder {
	width:100px;
	height:20px;
	bottom:0px;
	background-color:#FFFFFF;
	border:1px solid black;
	text-align:center;
}
.arr {
	cursor:pointer;
}
.arr:hover {
	color:#FFFFFF;
	background-color:#000000;
}
#viewport {
	left:100px;
	oveflow:hidden;
}
.current {
	top:50px;
	width:500px;
	height:25px;
	cursor:default;
	background-color: #DDDDDD;
	border-bottom: 1px solid black;
}
.current input{
	text-align: right;
}

#timeline{
	top:50px;
	left:5px;
	height:2px;
	width:100%;
	background-color: #000000;
	z-index:0;
}

#filmbuildboard {
	color:#000000;
}
#filmbuildboard input{
	position:absolute;
	text-align: right;
	cursor:default;
}

#scrollrightmask {
	background-color:#FFFFFF;
	width:20px;
	height:100%;
	right:0px;
}
#scrollbottommask{
	background-color:#FFFFFF;
	width:100%;
	height:20px;
	bottom:0px;
}
#scrollrightholder {
	background-color:#DDDDDD;
	width:20px;
	height:100%;
	right:0px;
}
#scrollbottomholder{
	background-color:#DDDDDD;
	left:100px;
	width:100%;
	height:20px;
	bottom:0px;
}
.out20 {
	opacity:0.20;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=20)";
    filter:alpha(opacity=20);
}
.in100 {
	opacity:1;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=100)";
    filter:alpha(opacity=100);
}

#scrollcorner{
	background-color:#555555;
	width:20px;
	height:20px;
	bottom:0px;
	right:0px;
	opacity:0.20;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=20)";
    filter:alpha(opacity=20);
}

#scup {
	position:absolute;
	top:2px;
}
#scdw {
	position:absolute;
	bottom:22px;
}	
#sclf {
	position:absolute;
	left:2px;
}
#scrt {
	position:absolute;
	right:22px;
}
#scrolllr {
	border:1px solid black;
	text-align:center;
	height:13px;
	width:25px;
	top:2px;
	left:21px;
	background-image: url("assets/scb.png");
	background-repeat: repeat-x; 
}
#scrollud {
	border:1px solid black;
	text-align:center;
	height:25px;
	width:13px;
	left:2px;
	top:21px;
	background-image: url("assets/scr.png");
	background-repeat: repeat-y; 
}
	
.allcontent {
	top:50px;
	width:100%;
	background-color:#FFFFFF;
	z-index:-100000000;
}

.allcontent img {
	cursor:pointer;
}

.buildhead {
	padding-left:20px;
	cursor:pointer;
}

.lbar {
	left:0px;
	width:2px;
	height:50px;
	background-color: #000000;
}

.rbar {
	right:0px;
	width:2px;
	height:50px;
	background-color: #000000;
}

.sclbar {
	left:0px;
	width:2px;
	height:75px;
	background-color: #000000;
}

.scrbar {
	right:-1px;
	width:3px;
	height:75px;
	background-color: #000000;
}

.bbar {
	top:50px;
	height:2px;
	width:100%;
	background-color: #000000;
}

.leftbar {
	left:0px;
	width:2px;
	height:100%;
	background-color: #000000;
	
}

.fleftbar {
	left:0px;
	width:2px;
	height:100%;
	background-color: #000000;
	cursor:e-resize;
}

.topbar {
	left:0px;
	width:100%;
	height:2px;
	background-color: #000000;
}

.rightbar {
	right:0px;
	width:2px;
	height:100%;
	background-color: #000000;
	cursor:e-resize;
}

.bottombar {
	bottom:0px;
	height:3px;
	width:100%;
	background-color: #000000;
	cursor:s-resize;
}

.rcornerbar {
	bottom:0px;
	right:0px;
	height:2px;
	width:2px;
	background-color: #FFFFFF;
	cursor: nw-resize;
}

.inner {
	left:2%;
	top:2%;
	width:96%;
	height:96%;
	overflow:auto;
	list-style: none;
}

ul.inner {
	list-style: none;
}

.shapesinner {
	left:2px;
	top:2px;
	width:96%;
	overflow:auto;
	list-style: none;
}

ul.shapesinner  {
	list-style: none;
	margin-left:-2em;
	margin-top:-0.1em;
}

inner img {
	cursor:pointer;
}

.innertext {
	cursor:pointer;
}

.innertext:hover {
	background-color: #F1ED55;
}

#listshapebox {
	border: 1px solid #000000;
	border-top:1px solid #000000;
	visibility:hidden;
	z-index:6;
}

#listshapecontent {
	height:100%;
	width:100%;
	background-color:#FFFFFF;
}

#done {
	position:absolute;
	left:500px;
	top:5px;
	visibility:hidden;
}

#checkdone {
	position:absolute;
	left:500px;
	top:5px;
	visibility:hidden;
}

#spbuttons {
	left:500px;
	top:5px;
	visibility:hidden;
}

#fmbuttons {
	left:500px;
	top:5px;
	width:140px;
	height:35px;
	visibility:hidden;
}

#rewindfm {
	position:absolute;
	top:4px;
	left:15px;
	cursor:pointer;
}

#playfm {
	position:absolute;
	top:4px;
	left:55px;
	cursor:pointer;
}
#pausefm {
	position:absolute;
	top:4px;
	left:55px;
	cursor:pointer;
}
 #playonfm {
 	position:absolute;
	top:4px;
	left:55px;
	cursor:pointer;
}
 #stopfm {
 	position:absolute;
	top:4px;
	left:95px;
	cursor:pointer;
}

#drop_zone {
	left:10px;
	width:330px;
	top:35px;
	height:270px;
	font-size: 12pt;
	font-weight: normal;
	border: solid 1px black;
	overflow: auto;
}

#message {
	left:10px;
	top:5px;
	width:330px;
	background-color: transparent;
}

#fileButtons {
	left:10px;
	top:315px;
	width:330px;
	background-color: transparent;
}

#shdirect{
	top:5px;
	height:20px;
	text-align: center;
	background-color: transparent;
}

#shadowuparrow,  #shadowdownarrow{
	width:23px;
	height:23px;
	top:28px;
}

#shadowdownarrow{
	top:74px;
}

#shadowsidearrows {
	width:47px;
	height:23px;
	top:51px;
}

#shblurtext{
	top:108px;
	height:20px;
	text-align: center;
	background-color: transparent;
}

#shblur{
	top:130px;
	height:20px;
	left:10px;
	width:220px;
	background-color: transparent;
}

#shslider, #shblurline {
	float:none;
	position: absolute;
}

#shslider {
	left:0px;
	top:0px;
}

#shblurline{
	left:0px;
	top:10px;
}

.rotation {
	visibility:hidden;
	font-size: 0px;
	cursor: move;
}

#shapestage, #scenestage, #spritestage, #trackstage, #tweenstage, #filmstage {
	visibility:hidden;
}

#dragstage {
	background-color:#FFFFFF;
	opacity:0.01;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=1)";
    filter:alpha(opacity=1);
    z-index:4;
}

#stageframe {
	visibility:hidden;
	border:1px solid black;
	z-index:0;
}

#stagearea {
	background-color: #FFFFFF;
	z-index:0;
}

.theatre_style {
	visibility:hidden;
	top:0px;
	left:0px;
	width: 100%;
	height:100%;
	z-index:1;
}

#hidecanvas {
	top:0px;
	left:0px;
	width: 10px;
	height:10px;
	background-color:transparent;
	visibility:hidden;
}

#heading {
	top: 0px;
	left:0px;
	width: 100%;
	height:50px;
	background-color:#66FFFF;
	z-index:1;
}


#logo {
	top: 4px;
	left: 200px;
}
	

#toolbar {
	top: 60px;
	left:10px;
	width: 95px;
	height:515px;
	z-index:10;
	border:solid 1px #000000;
	background-color:#66FFFF;
	visibility:hidden;
}

#tlbrhead {
	top: 0px;
	left:0px;
	width: 95px;
	height:25px;
	cursor:default;
	border-bottom:solid 1px #000000;
	background-color:#000099;
	color:#FFFFFF;
}


#anibar {
	top: 60px;
	left:200px;
	width: 95px;
	height:180px;
	z-index:4;
	border:solid 1px #000000;
	background-color:#FFFFFF;
	visibility:hidden;
}

#anibarhd {
	top: 0px;
	left:0px;
	width: 100%;
	height:23px;
	text-align:center;
	border-bottom:solid 1px #000000;
	background-color:#000000;
	color:#FFFFFF;
	cursor:default;
}

#anicontent {
	top:25px;
	left:0px;
	width:100%;
	height:150px;
}

#anishape, #anigroup, #aniscene, #anisprite, #anitween, #anitrack, #anifilm {
	left:2%;
	width: 92%;
	height:25px;
	background-color:#666666;
	color:#FFFFFF;
	border:solid 1px black;
	text-align: center;
	cursor: default;
}

#aniscene {
	top: 2px;
}

#anisprite {
	top: 32px;
}

#anitween {
	top: 62px;
}

#anitrack {
	top: 92px;
}

#anifilm {
	top: 122px;
}

#gradcanvas {
	position:absolute;
	top:52px;
	left:0px;

}

#colorbox {
	height:411px;
	width:335px;
	background-color:#FFFFFF;
	clip:rect(1,550px,430px,0);
}

#colormask {
	height:380px;
	width:325px;
	background-color:#FFFFFF;
}

#colorcontent {
	top:25px;
	left:0px;
	height:386px;
	width:335px;
	background-color:#FFFFFF;
}

#gradientBox {
	cursor:crosshair;
	top:15px;
	left:15px;
	width:256px;
	height:256px;
}

#gradientImg {
	display:block;
	width:256px;
	height:256px;
}

#transpbox {
	height:50px;
	width:256px;
	top:280px;
	left:15px;
}

#transpslider {
	height:17px;
	width:256px;
	top:9px;
	left:0px;
	border:1px solid black;
	filter:alpha(opacity=60);
	opacity:0.6;
}

#transpimg {
	height:17px;
	width:256px;
	top:9px;
	left:0px;
	border:1px solid black;

}

#transpcover {
	height:17px;
	width:256px;
	top:9px;
	left:0px;
	border:1px solid black;
}

#transptext {
	top:40px;
	left:0px;
}

#colform {
	top:350px;
	left:15px;
}
#varrows {
	width:9px;
	height:35px;
	left:0px;
	top:0px;	
}

#circle {
	height:11px;
	width:11px;
}

#hueBarDiv {
	left:280px;
	width:35px;
	height:256px;
	top:15px;
}

#colorbar {
	height:256px;
	width:19px;
	left:8px;
}
#arrows {
	height:9px;
	width:35px;
	left:0px;
}

#coldigits {
	left:155px;
	width:180px;
	height:256px;
	top:15px;
	background-color: #FFFFFF;
}

#colvertline {
	width:10px; 
	height:386px; 
	background-color: #888888; 
	left:170px;
	top:-15px;
}

#quickColor {
	height:50px;
	width:73px;
	top:0px;
	left:0px;	
}

#staticColor {
	height:50px;
	width:72px;
	top:0px;
	left:73px;
}

.choice40 {
	opacity:0.40;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=40)";
    filter:alpha(opacity=40);
	cursor:pointer;
}

.choice100 {
	opacity:1;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=100)";
    filter:alpha(opacity=100);
}

.notext {
	cursor: default;
}

#export {
	left:110px;
	top:4px;
	visibility:hidden;
}

#visit {
	left:60px;
	top:4px;
	visibility:hidden;
}

#help {
	left:10px;
	top:4px;
	visibility:hidden;
}

#menushape, #copy, #editlines, #group, #ungroup, #rotate, #collines, #gradfill, #sname, #alntop, #alnbot{
	left:50px;
	visibility:hidden; 
}

#grid, #del, #front, #back, #vert, #horz, #stylelines, #colfill, #shadow, #lundo, #alnright, #alnleft {
	left:5px;
	visibility:hidden;
}

#menushape, #grid {
	top:30px; 
}
#copy, #del {
	top:80px; 
}
#editlines, #group, #ungroup, #front, #back {
	top:130px; 
}

#rotate, #horz {
	top:180px; 
}
#collines, #stylelines {
	top:230px; 
}
#gradfill, #colfill {
	top:280px; 
}
#sname, #shadow {
	top:330px; 
}

#back {
	left:25px; 
}

#vert {
	top:196px; 
}

#lundo {
	top:430px; 
}
#alnright {
	left:25px; 
}

#fopts {
	left:110px;
	top:50px;
	padding:2px 2px 2px 2px;
	border:solid #000000 1px;
	background-color:#FFFFFF;
	visibility:hidden;
}

#vecdiv {
	left:500px;
	top:300px;
	width:220px;
	height:220px;
	visibility:hidden;
}

#vecrotate {
	left:210px;
	top:105px;
	width:10px;
	height:10px;
	font-size:0;
}

#spritecentre {
	left:500px;
	top:300px;
	width:20px;
	height:20px;

	font-size:0;
	visibility:hidden;
}

</style>
<script type="text/javascript" src="http://yui.yahooapis.com/combo?2.9.0/build/yahoo-dom-event/yahoo-dom-event.js&amp;2.9.0/build/dragdrop/dragdrop-min.js"></script> 
<script type="text/javascript" src="scripts/getElementsByClassName-1.0.1.js" ></script>
<script type="text/javascript" src = "scripts/mark.js" ></script>
<script type="text/javascript" src = "scripts/shape.js" ></script>
<script type="text/javascript" src = "scripts/draw.js" ></script>
<script type="text/javascript" src = "scripts/dialogue.js" ></script>
<script type="text/javascript" src = "scripts/group.js" ></script>
<script type="text/javascript" src = "scripts/shapemenu.js" ></script>
<script type="text/javascript" src = "scripts/drawboundary.js" ></script>
<script type="text/javascript" src = "scripts/corner.js" ></script>
<script type="text/javascript" src = "scripts/bottomhandle.js" ></script>
<script type="text/javascript" src = "scripts/righthandle.js" ></script>
<script type="text/javascript" src = "scripts/colorpicker.js" ></script>
<script type="text/javascript" src = "scripts/canvasshapes.js" ></script>
<script type="text/javascript" src = "scripts/reflect.js" ></script>
<script type="text/javascript" src = "scripts/shadowmenu.js" ></script>
<script type="text/javascript" src = "scripts/gradmenu.js" ></script>
<script type="text/javascript" src = "scripts/gradientmarker.js" ></script>
<script type="text/javascript" src = "scripts/builder.js" ></script>
<script type="text/javascript" src = "scripts/scenes.js" ></script>
<script type="text/javascript" src = "scripts/tracks.js" ></script>
<script type="text/javascript" src = "scripts/sprites.js" ></script>
<script type="text/javascript" src = "scripts/films.js" ></script>
<script type="text/javascript" src = "scripts/alongpath.js" ></script>

<script type="text/javascript" src = "scripts/export.js" ></script>
<script type="text/javascript" src = "scripts/exportfilmall.js" ></script>
<script type="text/javascript" src = "scripts/linemarker.js" ></script>
<script type="text/javascript" src = "scripts/rotate.js" ></script>
<script type="text/javascript" src = "scripts/grid.js" ></script>
<script type="text/javascript" src = "scripts/canvashtml.js" ></script>
<script type="text/javascript" src = "scripts/totext.js" ></script>
<script type="text/javascript" src = "scripts/fromtext.js" ></script>


<script type="text/javascript" src = "scripts/filmpropmenu.js" ></script>
<!--[IF LT IE 9]><script type="text/javascript" src = "scripts/excanvas.compiled.js" ></script><![endif]-->
<script type="text/javascript">


ieb=navigator.appName=='Microsoft Internet Explorer';
iop=navigator.appName=='Opera';
var blocknum=0;
var numblocks=0;
squote="'";
dquote='"';
var parentselected=null;

var lnmrks=0;
var gdmrks=0;
var rdmrks=0;
var rtmrks=0;
var bndries=0;
var hidnum=0;
var gpnum=0;
var inln=false;
var gp=[];
var firstclick=false;
var endpoint=false;
var curcanv='empty';
var currentColor = Colors.ColorFromRGB(64,128,128);
var alphaperct=0;
var coltype='F';
var xgrid=1;
var ygrid=1;
var grdon=false;
var showgrd=false;
var shapestarted=false;
var coldir='up';
var masterwidth;
var masterheight;
var storedw=0;
var storedh;
var magscale=100;
var actualwidth;
var actualheight;
var activewidth;
var activeheight;
var shapejustcreated=false;
var editjustcreated=false;
var undo=[];
var worksaved=false;
var flname='';
var fstar='';
var logurl='';
var filecount=0;
var file=[];
var filenum=0;
var canvases=0
var subcount=0;
var subfile=[];
var subfilenum=0;
var stf=[];
var piccount=0;
var picfile=[];
var picfilenum=0;
var pctf=[];
var aniselect=[];

var vector={xs:0, xe:0,ys:0, ye:0};
var vecanv;
var vecphi;
var midx={x:0,y:0};
var spritecentre;
var aniobj='scene';
var doingani=false;
var tracktarg;
var anitarg;
var ani;
var scenecount=0;
var trackcount=0;
var spritecount=0;
var tweencount=0;
var filmcount=0;
var canvases;
var elmsadded;
var editcheck=false;
var trackcheck=false;
var flmovetop;
var flmoveleft;
var MINIVECT={xs:0, xe:100,ys:0, ye:0}; //vector direction of sprite vector
var CURSOR;  //previous cursor point
var SHAPES={};  // list of shapes
var SELECTED={}; //list of selected shapes and groups;
var SELECTEDSHAPE; //shape clicked on
var DELETED={}; //list of deleted shapes and groups;
var DELETES=[]; //array of DELETED 
var GROUPS={}; //list of groups
var SCRW; //actual screen width
var SCRH; //actual screen height
var MCOUNT=0; //counter for id of marks
var BCOUNT=0; //counter for id of boundaries
var SCOUNT=0; //counter for shapes
var GCOUNT=0; //counter for groups
var ZPOS=1; //zindex for each shape as created or set to front
var ZNEG=-1; //zindex for shapes when zindex sent to back
var K=4*(Math.SQRT2-1)/3; //constant for circles using Bezier curve.
var ROTATIONRADIUS=100; //radius for rotation marker;
var DEFAULTKEYDOWN=document.onkeydown;
var BACKDROP; // object where backstage canvas is added for bezguides, gradient stops, rotation markers;
var BOXES; //array of class dialogue boxes;
var BOXNAME; //name of dialogue box, id with box dropped from end;
var DD=[]; //array of drag and drop elements for dialogue boxes;

var BARS=["right","bottom","rcorner"]; //array for edge classes;
var	ANIELS=["sc","sp","tr","tw","fm","ls","fl"];
var ED=[]; //array of drag and drop elements for element boxes;
var EDCOUNT=0; //counter for ED
temptrack={};
var TRACKS = {};  //associative array for tracks
var SCENES = {}; //associative array for scenes
var SPRITES = {}; //associative array for sprites
var TWEENS = {}; //associative array for tweens
var FILMS = {}; //associative array for films

var FILMBOARD = {} //associative array of elements on the filmbuildboard

var TRCOUNT=0; //counter for tracks
var SCCOUNT=0; //counter for scenes
var SPCOUNT=0; //counter for sprites
var TWCOUNT=0; //counter for tweens
var FMCOUNT=0; //counter for films
var ELCOUNT=0; //counter for elements on filmbuildboard;

var FLELTOP=5; //top position of element on filmboard;
var FLELWIDTH;
var FLELHEIGHT;
var FLELHEAD; //head of double linked list of film elements.
var FLELINDX; //z-index for elements on filmlines
var NCOUNT=0; //counter for element shapes
var CURRENT=SHAPES; //pointer to current associative array of shapes;

var DDDIVS={};


var STOPCHECKING=false;
var SPANCOUNT=0; //counter for spans in list
var LIMARGIN;
var ZBOX=10; //z-index for tool bars and dialogueboxes;
EXCANVASUSED = !document.createElement("canvas").getContext;


//String.prototype.elType=elType;

if(typeof String.prototype.trim !== 'function') {
  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, ''); 
  }
}

if(!Array.indexOf){
	    Array.prototype.indexOf = function(obj){
	        for(var i=0; i<this.length; i++){
	            if(this[i]==obj){
	                return i;
	            }
	        }
	        return -1;
	    }
	}


function $(id)
{
      return document.getElementById(id);
}

for( var i=0; i<3; i++)
{
	stf[i]=false;
}

for( var i=0; i<3; i++)
{
	pctf[i]=false;
}

function str_rep(n) 
{
   var s = "", t = this.toString();
   while (--n >= 0) 
   {
     s += t
   }
   return s;
}

String.prototype.repeat = str_rep;
var SPACES =" ".repeat(100);

function eventcap(e)
{
	if (!e) var e = window.event;
	return e;
}

function noBubble(e)
{
	if (!e) var e = window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
}

function cancelEvent(e) 
{
	if (!e) e = window.event;
	if (e.preventDefault) 
	{
		e.preventDefault();
	} 
	else 
	{
		e.returnValue = false;
	}
}

function shiftdown(e)
{
	
	e = e || window.event;
	return e.shiftKey;
}

function getPosition(e) {
    e = e || window.event;
    var cursor = {x:0, y:0};
    if (e.pageX || e.pageY) {
        cursor.x = e.pageX;
        cursor.y = e.pageY;
    } 
    else {
        var de = document.documentElement;
        var b = document.body;
        cursor.x = e.clientX + 
            (de.scrollLeft || b.scrollLeft) - (de.clientLeft || 0);
        cursor.y = e.clientY + 
            (de.scrollTop || b.scrollTop) - (de.clientTop || 0);
    }
    return cursor;
}





function openhelp()
{
	window.open('https://sites.google.com/site/canvimationhelp/');
}

function visitgallery()
{
	window.open('gallery/vector continuous.html');
}


function shapedelete()
{
	var i=0;
	for(var name in CURRENT)
	{
		i++;
	}
	if(i==1 && !(CURRENT===SHAPES))
	{
		alert("It is not possible to delete the last shape." );
		return;
	}
	$('shapemenu').style.visibility='hidden';
	$('listshapebox').style.visibility='hidden';
	$('group').style.visibility='hidden';
	$('ungroup').style.visibility='hidden';
	$('stylelines').style.visibility='hidden';
	$('collines').style.visibility='hidden';	
	$('colfill').style.visibility='hidden';
	$('gradfill').style.visibility='hidden';
	$('rotate').style.visibility='hidden';
	$('front').style.visibility='hidden';
	$('back').style.visibility='hidden';
	$('del').style.visibility='hidden';
	$('copy').style.visibility='hidden';
	$('editlines').style.visibility='hidden';
	$('vert').style.visibility='hidden';
	$('horz').style.visibility='hidden';
	$('alntop').style.visibility='hidden';
	$('alnbot').style.visibility='hidden';
	$('alnleft').style.visibility='hidden';
	$('alnright').style.visibility='hidden';
	$('shadow').style.visibility='hidden';
	$('sname').style.visibility='hidden';
	closeColor();
	removeGradLine();
	removeRotate();	
	closeStops();
	for(var groupName in SELECTED)
	{
		DELETED[groupName]=SELECTED[groupName];
		var members=SELECTED[groupName].memberShapes();
		for(var shapeName in members)
		{
			var shape=members[shapeName];
			shape.Canvas.style.visibility="hidden";
			delete CURRENT[shape.name];
		}
	}
	DELETES.push(DELETED);
	SELECTED={};
	clear($("boundarydrop"));
	$('lundo').style.visibility='visible';
}


function undolast()
{
	var selection=DELETES.pop();
	for(var groupName in selection)
	{
		var group=selection[groupName];
		var members=group.memberShapes();
		for(shapeName in members)
		{
			var shape=members[shapeName];
			shape.Canvas.style.visibility="visible";
			SHAPES[shape.name]=shape
		}
		
	}
	if (DELETES.length==0) {$('lundo').style.visibility='hidden'};
}

function clear(stage)
{
	while(stage.childNodes.length>0)
	{
		stage.removeChild(stage.firstChild)
	}
	if(stage.id=="boundarydrop")
	{
		$("tracktext").innerHTML="&nbsp;&nbsp;Select just one shape.";
	}
}





function setStage(stagewidth,stageheight)
{
	var stages=["area","frame"];
	for(var i=0; i<stages.length; i++)
	{
		$('stage'+stages[i]).style.top=((SCRH-stageheight)/2 - 52)+"px";
		$('stage'+stages[i]).style.left=((SCRW-stagewidth)/2)+"px";
		$('stage'+stages[i]).style.width=stagewidth+"px";
		$('stage'+stages[i]).style.height=stageheight+"px";
		$('stage'+stages[i]).style.visibility="visible";
	}
	$('stagebox').style.visibility="hidden";
	$('shapestage').style.visibility="visible";
	main();
}

function init()
{	
	SCRW=screen.availWidth;
	SCRH=screen.availHeight;
	$('startdiv').parentNode.removeChild($('startdiv'));
	$('stagebox').style.width=200+"px";
	$('stagebox').style.height=150+"px";
	$('stagecontent').style.height=(parseInt($('stagebox').style.height)-25)+"px";
	$('stagebox').style.top=((SCRH-parseInt($('stagebox').style.height))/2 - 52)+"px";
	$('stagebox').style.left=((SCRW-parseInt($('stagebox').style.width))/2)+"px";
	$('stageOK').style.left=(parseInt($('stagebox').style.width)-70)+"px";
	$('stagebox').style.visibility="visible";
	
}
	
function main()
{	
	BODY=document.getElementsByTagName("body")[0];
	$('toolbar').style.visibility='visible';
	$('anibar').style.visibility='visible';
	$('grid').style.visibility='visible';
	$('menushape').style.visibility='visible';
	$('background').style.visibility='visible';
	BACKDROP={};
	BACKDROP.zIndex=0;
	BACKDROP.addTo=addTo;
	BACKDROP.addTo($("backstage"));
	GRIDDROP={};
	GRIDDROP.zindex=0;
	GRIDDROP.width=30;
	GRIDDROP.height=30;
	GRIDDROP.addTo=addTo;
	GRIDDROP.addTo($("griddrop"));
	$("griddrop").style.zIndex=0;
	$("markerdrop").style.visibility="visible";
	$("markerdrop").onclick=function(e) {
	   										noBubble(e);
	   										checkBoundary(shiftdown(e),getPosition(e));
	   									}
	$("frontmarkerdrop").onclick=function(e) {
	   										noBubble(e);
	   										checkBoundary(shiftdown(e),getPosition(e));
	   									}
	 $("boundarydrop").onclick=function(e) {
	   										noBubble(e);
	   										checkBoundary(shiftdown(e),getPosition(e));
	   									}  									
	
	canvwidth=0.98*screen.availWidth;
	canvheight=0.785*screen.availHeight;
	maxwidth=canvwidth;
	maxheight=canvheight;
	masterwidth=0.80*maxwidth;
	masterheight=0.80*maxheight;
	gridcanv=$('gridcanvas');
	$('filmdivhandle').style.top=(masterheight/2-25)+"px";
	$('filmdivhandle').style.left=(masterwidth/2-25)+"px";
	//fhtfix=masterheight/2-25;
	//fhlfix=masterwidth/2-25;

	if (!ieb)
	{
		document.getElementsByTagName('body')[0].addEventListener('dragover', handleDragOver, false);
		document.getElementsByTagName('body')[0].addEventListener('drop', handleBodyDrop, false);
	}
		
	$('toolbar').style.left=20+"px";
	$('toolbar').style.top=60+"px";
	$('anibar').style.left=(SCRW-120)+"px";
	$('anibar').style.top="60px";
/*	$('canvasdiv').style.height=(maxheight-52)+"px";
	$('canvasdiv').style.width=maxwidth+"px";
	$('canvasdiv').style.zIndex=2;*/

	$('animationdiv').style.height=(maxheight-52)+"px";
	$('animationdiv').style.width=maxwidth+"px";
	
	//dialogue box settings .....................................
	
	//colorbox
	$('colorbox').style.height=411+"px";
	$('colorbox').style.width=335+"px";
	
	$("coldigits").style.left=155+"px";	
		
	//linebox
	$('linebox').style.width=230+"px";
	$('linebox').style.height=200+"px";
	
	//namebox
	$('namebox').style.width=180+"px";
	$('namebox').style.height=120+"px";	
	
	//gradfillbox
	$('gradfillbox').style.width=160+"px";
	$('gradfillbox').style.height=170+"px";
	$("linear").checked="checked";
	
	//gridbox
	$('gridbox').style.width=200+"px";
	$('gridbox').style.height=250+"px";
	$("gridoff").checked="checked";
	$("gridhide").checked="checked";
	
	//rotatebox
	$('rotatebox').style.width=130+"px";
	$('rotatebox').style.height=120+"px";
	
	//fromtextbox
	$("fromtextbox").style.width=350+"px";
	$("fromtextbox").style.height=140+"px";
	
	//filetextbox
	$("filetextbox").style.width=350+"px";
	$("filetextbox").style.height=375+"px";
	
	//rotation markers
	$("rotateCentre").style.width=12+"px";
	$("rotateCentre").style.height=12+"px";
	$("rotateMove").style.width=12+"px";
	$("rotateMove").style.height=12+"px";
	DDrtC=new YAHOO.util.DD("rotateCentre");
	DDrtC.onDrag=function(){updatecenter()};
	DDrtM=new YAHOO.util.DD("rotateMove");
	DDrtM.onDrag=function(){updateangle()};
	
	$("rotateCentre").onmouseover=function(){
										this.style.cursor="move";
										$("frontmarkerdrop").onclick=function(e) {noBubble(e)};
									};
   	$("rotateCentre").onmouseout=function(){
	   									this.style.cursor="default";
	   									$("frontmarkerdrop").onclick=function(e) {
	   																			noBubble(e);
	   																			checkBoundary(shiftdown(e),getPosition(e));
	   																			BACKDROP.Canvas.ctx.clearRect(0,0,SCRW,SCRH);
	   																			removeRotate();
	   																			$("frontmarkerdrop").style.visibility="hidden";
	   																			$("backstage").style.visibility="hidden";
	   																			$("boundarydrop").style.visibility="visible";
	   																		}
									};
									
	$("rotateMove").onmouseover=function(){
										this.style.cursor="move";
										$("frontmarkerdrop").onclick=function(e) {noBubble(e)};
									};
   	$("rotateMove").onmouseout=function(){
	   									this.style.cursor="default";
	   									$("frontmarkerdrop").onclick=function(e) {
	   																			noBubble(e);
	   																			checkBoundary(shiftdown(e),getPosition(e));
	   																			BACKDROP.Canvas.ctx.clearRect(0,0,SCRW,SCRH);
	   																			removeRotate();
	   																			$("frontmarkerdrop").style.visibility="hidden";
	   																			$("backstage").style.visibility="hidden";
	   																			$("boundarydrop").style.visibility="visible";
	   																		}
									};
	
	//shadowbox
	$('shadowbox').style.width=250+"px";
	$('shadowbox').style.height=220+"px";
	
	$("shdirectup").onmouseover=function() {this.src="assets/shupin.png"};
	$("shdirectup").onmouseout=function() {this.src="assets/shup.png"};
	$("shdirectup").onmousedown=function() {movshdup()};
	$("shdirectup").onmouseup=function() {stopshdup()};
	$("shdirectleft").onmouseover=function() {this.src="assets/shleftin.png"};
	$("shdirectleft").onmouseout=function() {this.src="assets/shleft.png"};
	$("shdirectleft").onmousedown=function() {movshdleft()};
	$("shdirectleft").onmouseup=function() {stopshdleft()};
	$("shdirectright").onmouseover=function() {this.src="assets/shrightin.png"};
	$("shdirectright").onmouseout=function() {this.src="assets/shright.png"};
	$("shdirectright").onmousedown=function() {movshdright()};
	$("shdirectright").onmouseup=function() {stopshdright()};
	$("shdirectdown").onmouseover=function() {this.src="assets/shdownin.png"};
	$("shdirectdown").onmouseout=function() {this.src="assets/shdown.png"};
	$("shdirectdown").onmousedown=function() {movshddown()};
	$("shdirectdown").onmouseup=function() {stopshddown()};
	$("shadowuparrow").style.left=(parseInt($("shadowbox").style.width)/2-11)+"px";
	$("shadowsidearrows").style.left=(parseInt($("shadowbox").style.width)/2-23)+"px";
	$("shadowdownarrow").style.left=(parseInt($("shadowbox").style.width)/2-11)+"px";
	$("shdirect").style.width=(parseInt($("shadowbox").style.width))+"px";
	$("shblurtext").style.width=(parseInt($("shadowbox").style.width))+"px";
	$("shblurline").onclick=function (e) {
										var cursor=getPosition(e)
										$('shslider').style.top=0+"px";
										$('shslider').style.left=(cursor.x-(parseInt($('shadowbox').style.left))-10)+"px";
										if (parseInt($('shslider').style.left)<0) {$('shslider').style.left=0+"px"}
										if (parseInt($('shslider').style.left)>212) {$('shslider').style.left=212+"px"}
										for(var groupName in SELECTED)
										{
											var group=SELECTED[groupName];
											var shapeNames=group.memberShapes();
											for(var name in shapeNames)
											{
												shape=shapeNames[name];
												shape.shadowBlur=parseInt($('shslider').style.left)/5;
												shape.draw();
											}
										}
  								};
								
	DDshslider=new YAHOO.util.DD('shslider');
	DDshslider.onDrag = function () {
										$('shslider').style.top=0+"px";
										if (parseInt($('shslider').style.left)<0) {$('shslider').style.left=0+"px"}
										if (parseInt($('shslider').style.left)>212) {$('shslider').style.left=212+"px"}
										for(var groupName in SELECTED)
										{
											var group=SELECTED[groupName];
											var shapeNames=group.memberShapes();
											for(var name in shapeNames)
											{
												shape=shapeNames[name];
												shape.shadowBlur=parseInt($('shslider').style.left)/5;
												shape.draw();
											}
										}
  
								};
	
	//pointsbox
	$('pointsbox').style.width=156+"px";
	$('pointsbox').style.height=300+"px";
	
	$("p_points").style.top=0+"px";
	$("p_points").style.backgroundColor="#888888";
	$("p_points").style.color="#F09898";
	$("p_corner").style.top=25+"px";
	$("p_smooth").style.top=50+"px";
	$("p_inline").style.top=75+"px";
	$("p_delete").style.top=100+"px";
	$("p_open").style.top=125+"px";
	$("p_segments").style.top=150+"px";
	$("p_segments").style.backgroundColor="#888888";
	$("p_line").style.top=175+"px";
	$("p_line").style.width=(parseInt($('pointsbox').style.width)/2)+"px";
	$("p_line2").style.left=(parseInt($('pointsbox').style.width)/2)+"px";
	$("p_line2").style.top=175+"px";
	$("p_line2").style.width=(parseInt($('pointsbox').style.width)/2)+"px";
	$("p_add").style.top=200+"px";
	$("p_add").style.width=(parseInt($('pointsbox').style.width)/2)+"px";
	$("p_add2").style.top=200+"px";
	$("p_add2").style.left=(parseInt($('pointsbox').style.width)/2)+"px";
	$("p_add2").style.width=(parseInt($('pointsbox').style.width)/2)+"px";
	$("p_paths").style.top=225+"px";
	$("p_paths").style.backgroundColor="#888888";
	$("p_paths").style.color="#95B3D7";
	$("p_close").style.top=250+"px";
	
//Builder dialogue boxes
	$("scenebuildbox").style.width="200px";
	$("scenebuildbox").style.height="220px";
	$("scblank").checked="checked";
	
	$("trackbuildbox").style.width="200px";
	$("trackbuildbox").style.height="270px";
	
	
	$("spritebuildbox").style.width="250px";
	$("spritebuildbox").style.height="250px";
	DDeldrop=new YAHOO.util.DDTarget("eldrop","ELGROUP");
	DDtrackdrop=new YAHOO.util.DDTarget("trackdrop","TRGROUP");
	
//Editor dialogue boxes
	$("sceneeditbox").style.width="200px";
	$("sceneeditbox").style.height="140px";
	
	$("trackeditbox").style.width="200px";
	$("trackeditbox").style.height="260px";
	
	$("spriteeditbox").style.width="250px";
	$("spriteeditbox").style.height="230px";
	
	BOXES=getElementsByClassName("dialoguebox");
	for(var i=0; i<BOXES.length; i++)
	{
		BOXNAME=BOXES[i].id.substr(0,BOXES[i].id.length-3);
		BOXES[i].style.top=((SCRH-parseInt(BOXES[i].style.height))/2 - 52)+"px";
		BOXES[i].style.left=((SCRW-parseInt(BOXES[i].style.width))/4)+"px";
		BOXES[i].style.clip="rect(1px,"+(parseInt(BOXES[i].style.width)+2)+"px,"+(parseInt(BOXES[i].style.height)+2)+"px,0px)";
		BOXES[i].style.visibility="hidden";
		$(BOXNAME+"content").style.height=(parseInt(BOXES[i].style.height)-25)+"px";
		$(BOXNAME+"content").style.top=25+"px";
		
		DD=new YAHOO.util.DD(BOXES[i].id);
		DD.setHandleElId(BOXNAME+"head");
		DD.onMouseDown=function() {$(this.id).style.zIndex=ZBOX++};
	}
	
	BOXES=getElementsByClassName("elementsbox");
	for(var i=0; i<BOXES.length; i++)
	{
		BOXNAME=BOXES[i].id.substr(0,BOXES[i].id.length-3);
		BOXES[i].style.top=(60+i*30)+"px";
		BOXES[i].style.left=(100+i*220)+"px";
		BOXES[i].style.width=250+"px";
		BOXES[i].style.height=250+"px";
		BOXES[i].style.clip="rect(1px,"+(parseInt(BOXES[i].style.width)+2)+"px,"+(parseInt(BOXES[i].style.height)+2)+"px,0px)";
		BOXES[i].style.visibility="hidden";
		$(BOXNAME+"content").style.height=(parseInt(BOXES[i].style.height)-50)+"px";
		$(BOXNAME+"content").style.top=50+"px";
		
		DD=new YAHOO.util.DD(BOXES[i].id);
		DD.setHandleElId(BOXNAME+"head");
		DD.onMouseDown=function() {$(this.id).style.zIndex=ZBOX++};
	}
	
	$("filmbuildbox").style.left="200px";
	$("filmbuildbox").style.width="375px";
	$("filmbuildbox").style.height="270px";
	$("filmbuildbox").style.clip="rect(1px,377px,272px,0px)";
	$("filmbuildcontent").style.height="195px";
	$("filmbuildcontent").style.top="75px";
	$("filmbuildstory").style.width="450px";
	$("filmbuildstory").style.height="295px";
	$("filmbuildlines").style.width="375px";
	$("filmbuildlines").style.height="195px";
	//$("filmbuildlines").style.zIndex=-10000000;
	$("timeline").style.width=(parseInt($("filmbuildlines").style.width)-25)+"px";
	$("flellistholder").style.height="174px";
	$("viewport").style.width="275px";
	$("viewport").style.height="175px";
	$("filmbuildboard").style.width="275px";
	$("filmbuildboard").style.height="195px";
	$("scrollud").style.height=((parseInt($("viewport").style.height)-40)*(parseInt($("filmbuildbox").style.height)-75)/parseInt($("filmbuildstory").style.height))+"px";
	$("scrollud").height=parseInt($("scrollud").style.height);
	$("scrollud").style.top="21px";
	$("scrollud").top=parseInt($("scrollud").style.top);
	DDscrollud=new YAHOO.util.DD("scrollud");
	DDscrollud.onDrag=function() {
										$("scrollud").style.left="2px";
										if(parseInt($("scrollud").style.top)<=21)
										{
											$("scrollud").style.top="21px";
										}
										if(parseInt($("scrollud").style.top)+parseInt($("scrollud").style.height)>=(parseInt($("viewport").style.height)-22))
										{
											$("scrollud").style.top=$("scrollud").top+"px";
										}
										$("scrollud").top=parseInt($("scrollud").style.top);
										$("scrollrightholder").className="in100";
										var sctop=$("scrollud").top-21;
										var barheight=(parseInt($("viewport").style.height)-42);
										var storyheight=parseInt($("filmbuildstory").style.height);
										var storytop=storyheight*sctop/barheight;
										$("filmbuildstory").style.top=-storytop+"px";
										$("flellist").style.top=parseInt($("filmbuildstory").style.top)+"px";	
									}
	DDscrollud.endDrag=function() {
									$("scrollrightholder").className="out20";
								  }	
								  
	$("scrolllr").style.width=((parseInt($("viewport").style.width)-42)*(parseInt($("filmbuildbox").style.width))/parseInt($("filmbuildstory").style.width))+"px";
	$("scrolllr").width=parseInt($("scrolllr").style.width);
	$("scrolllr").style.left="21px";
	$("scrolllr").left=parseInt($("scrolllr").style.left);
	DDscrolllr=new YAHOO.util.DD("scrolllr");
	DDscrolllr.onDrag=function() {
										$("scrolllr").style.top="2px";
										if(parseInt($("scrolllr").style.left)<=21)
										{
											$("scrolllr").style.left="21px";
										}
										if(parseInt($("scrolllr").style.left)+parseInt($("scrolllr").style.width)>=(parseInt($("viewport").style.width)-22))
										{
											$("scrolllr").style.left=$("scrolllr").left+"px";
										}
										$("scrolllr").left=parseInt($("scrolllr").style.left);
										$("scrollbottomholder").className="in100";
										var scleft=$("scrolllr").left-21;
										var barwidth=(parseInt($("viewport").style.width)-42);
										var storywidth=parseInt($("filmbuildstory").style.width);
										var storyleft=storywidth*scleft/barwidth;
										$("filmbuildstory").style.left=-storyleft+"px";	
									}
	DDscrolllr.endDrag=function() {
									$("scrollbottomholder").className="out20";
								  }								  
								  							
	FLELWIDTH=350;
	FLELHEIGHT=295;
	DDelfilmdrop=new YAHOO.util.DDTarget("filmbuildboard","ELGROUP");
	
	for(var i=0;i<ANIELS.length;i++)
	{
		for(var j=0;j<BARS.length;j++)
		{
			BOXNAME=BARS[j]+"bar"+ANIELS[i];
			ED[EDCOUNT]=new YAHOO.util.DD(BOXNAME);
			ED[EDCOUNT++].onDrag=function(e) {
												resize(this.id);
											}
		}
	} 
	
	
	
	$("toolbar").appendChild($("listshapebox"));
	$("listshapebox").style.left=75+"px"; 
	$("listshapebox").style.top=50+"px";
	$("listshapebox").style.width=140+"px";
	$("listshapebox").style.height=200+"px";
	
	$("done").style.visibility="hidden";
	$("checkdone").style.visibility="hidden";
	
	if(ieb)
	{
		DROPS=getElementsByClassName("theatre_style");
		for(var i=0; i<DROPS.length; i++)
		{
			DROPS[i].style.backgroundImage="url(assets/clear.png)";
		}
		
	}
	
	$("colorbox").style.clip="rect(1px,550px,430px,0px)";
	$("colorbox").style.left=(3*(SCRW-parseInt($("colorbox").style.width))/4)+"px";	
		
	$('export').style.visibility='visible';
	$('visit').style.visibility='visible';
	$('help').style.visibility='visible';
	
	
	DDtlbr=new YAHOO.util.DD('toolbar');
	DDtlbr.setHandleElId('tlbrhead');
	DDtlbr.onMouseDown=onMouseDown=function() {$(this.id).style.zIndex=ZBOX++};	
	
/*	DDtlbr=new YAHOO.util.DD('filmsbar');
	DDtlbr.setHandleElId('filmsbarhead');
	DDtlbr.onMouseDown=function() {$(this.id).style.zIndex=ZBOX++}; */

	DDanibr=new YAHOO.util.DD('anibar');
	DDanibr.setHandleElId('anibarhd');
	DDanibr.onMouseDown=function() {$(this.id).style.zIndex=ZBOX++};
	
	DDcircle=new YAHOO.util.DD('circle');
	DDcircle.onDrag = function () {
									if (parseInt($('circle').style.left)<-5) {$('circle').style.left=-5+"px"}
									if (parseInt($('circle').style.left)>250) {$('circle').style.left=250+"px"}
									if (parseInt($('circle').style.top)<-5) {$('circle').style.top=-5+"px"}
									if (parseInt($('circle').style.top)>250) {$('circle').style.top=251+"px"}
									currentColor.SetHSV(currentColor.Hue(), 1-(parseInt($('circle').style.top)+5)/255.0, 
									  (parseInt($('circle').style.left)+5)/255.0);
  									colorChanged("circle");
								  }
	DDarrows=new YAHOO.util.DD('arrows');
	DDarrows.onDrag = function () {
										$('arrows').style.left=0+"px";
										if (parseInt($('arrows').style.top)<-4) {$('arrows').style.top=-4+"px"}
										if (parseInt($('arrows').style.top)>251) {$('arrows').style.top=251+"px"}
  										currentColor.SetHSV((256 - parseInt($('arrows').style.top)+4)*359.99/255, 
										  currentColor.Saturation(), currentColor.Value());
  										colorChanged("arrows");
								};

									
	$('varrows').style.left=-4+"px";
	DDvarrows=new YAHOO.util.DD('varrows');
	DDvarrows.setHandleElId("transpbox");
	DDvarrows.onDrag = function () {
										$('varrows').style.top=0+"px";
										if (parseInt($('varrows').style.left)<-4) {$('varrows').style.left=-4+"px"}
										if (parseInt($('varrows').style.left)>252) {$('varrows').style.left=252+"px"}
										alphaperct=Math.ceil(100*(parseInt($('varrows').style.left)+4)/256);
										$('transptext').innerHTML ='Transparency '+alphaperct+'%';
										if (EXCANVASUSED)
										{
											$('transpslider').filters.alpha.opacity=100-alphaperct;
										}
										else
										{
											$('transpslider').style.opacity=1-alphaperct/100;
										}
											
  
								};
																			
	

	fixGradientImg();
	
	colorChanged('box');
													  
	var su = new imageShapeMenu();
		
	$("redBox").value=255;
	redBoxChanged();
	$("greenBox").value=255;
	greenBoxChanged();
	$("blueBox").value=255;
	blueBoxChanged();
	alphaperct = 0;
	$('varrows').style.left=(256*alphaperct/100-4)+"px";
	$('transptext').innerHTML ='Transparency '+Math.floor(alphaperct)+'%';
	if (EXCANVASUSED)
	{
		$('transpslider').filters.alpha.opacity=100-alphaperct;
	}
	else
	{
		$('transpslider').style.opacity=1-alphaperct/100;
	}
	$("transpslider").style.backgroundColor = currentColor.HexString();
	$('colorheadtext').innerHTML='\u00A0 Background Colour';

	$('gradientBox').onclick=function(e) {
											moveCircleTo(getPosition(e))
										};
	
	$('transpbox').onclick=function(e) {
											movetransarrwTo(getPosition(e))
										};
	$('hueBarDiv').onclick=function(e) {
											HueBarmoveTo(getPosition(e))
										};															
	
	
	$('vecdiv').style.left=500+"px";
	$('vecdiv').style.top=200+"px";
	$('vecdiv').style.zIndex=1;
	vecanv=$('vecanv')
    if (vecanv.getContext)
	{
        vecanv.ctx = vecanv.getContext('2d');
    }
	vecanv.width=220;
   	vecanv.height=220;
	vecanv.ctx.translate(110,110);
	vecanv.ctx.save();
	vecanv.ctx.beginPath();
	vecanv.ctx.moveTo(0,0);	
	vecanv.ctx.lineTo(100,0);
	vecanv.ctx.moveTo(90,-10);
	vecanv.ctx.lineTo(100,0);
	vecanv.ctx.lineTo(90,10);
	vecanv.ctx.stroke();
	
	
	DDvecdiv=new YAHOO.util.DD('vecdiv');
	
	vecirc=$('vecircdiv')
	$("vecrotate").style.zIndex=100;
    if (vecirc.getContext)
	{
        vecirc.ctx = vecirc.getContext('2d');
    }
	vecirc.width=10;
   	vecirc.height=10;
	vecirc.ctx.translate(5,5);
	
	vecirc.ctx.beginPath();
	vecirc.ctx.arc(0,0,5,0,2*Math.PI, false);
	vecirc.ctx.stroke();
	vecphi=0;
	
	DDvecrotate=new YAHOO.util.DD('vecrotate');
	DDvecrotate.onDrag = function()
						 {
						 		var phi=arctan(parseInt($('vecrotate').style.top)-105,parseInt($('vecrotate').style.left)-105);
								$('vecrotate').style.left=(105+105*Math.cos(phi))+"px";
								$('vecrotate').style.top=(105+105*Math.sin(phi))+"px";
								MINIVECT.xe=100*Math.cos(phi);
								MINIVECT.ye=100*Math.sin(phi);
								vecanv.ctx.rotate(-vecphi);
								vecanv.ctx.clearRect(-220,-220,440,440);
								
								vecphi =phi;
								
								vecanv.ctx.beginPath();
								vecanv.ctx.rotate(phi);
								vecanv.ctx.moveTo(0,0);	
								vecanv.ctx.lineTo(100,0);
								vecanv.ctx.moveTo(90,-10);
								vecanv.ctx.lineTo(100,0);
								vecanv.ctx.lineTo(90,10);
								vecanv.ctx.stroke();
						 }

	spritemid=$('spritemidiv');
    if (spritemid.getContext)
	{
        spritemid.ctx = spritemid.getContext('2d');
    }
	spritemid.width=20;
   	spritemid.height=20;
	spritemid.ctx.translate(10,10);
	
	spritemid.ctx.beginPath();
	spritemid.ctx.arc(0,0,10,0,2*Math.PI, false);
	spritemid.ctx.moveTo(0,10);
	spritemid.ctx.lineTo(0,-10);
	spritemid.ctx.moveTo(-10,0);
	spritemid.ctx.lineTo(10,0);
	spritemid.ctx.stroke();

	$('spritecentre').style.left=500+"px";
	$('spritecentre').style.top=200+"px";
	$('spritecentre').style.zIndex=1;
	DDspritecentre=new YAHOO.util.DD('spritecentre');
	
	
	if (window.File && window.FileReader && window.FileList && window.Blob && !iop) 
	{
		$('ifas').innerHTML='Open Files';
	}
	
/*	
	A=new Group();
	A.members=["a","b","c"];
	D=new Group();
	D.members=["d", "e", A];
	F=new Group();
	F.members=["f"];
	G=new Group();
	G.members=["g", "h"];
	H=new Group();
	H.members=[F,G];
	K=new Group();
	K.members=["k",D,H];
	alert(separate(K.members));
*/	
}

</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23932681-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body onLoad="init()">
<div id='startdiv' 	style='width:100%; height:100%; top:52px; background-color:#FFFFFF; font-size:18px'>
      <div style='top:200px;left:400px '><img alt="" src='assets/3d_cd.gif'/> Please wait while the application finishes loading.....</div>
</div>



<!--<div id="canvasdiv"></div>-->
<div id="hidecanvas"></div>
<div id='animationdiv'></div>
<div id="bodydiv"></div>
<div id="filmbodydiv"></div>
<div id="filmdivhandle"></div>

<div id='background'></div>
<div id='stagearea'></div>


<div id="shapestage" class="theatre_style"></div>
<div id="scenestage" class="theatre_style"></div>
<div id="spritestage" class="theatre_style"></div>
<div id="trackstage" class="theatre_style"></div>
<div id="tweenstage" class="theatre_style"></div>
<div id="filmstage" class="theatre_style"></div>
<div id="dragstage" class="theatre_style"></div>

<div id="stageframe"></div>

<div id="griddrop" class="theatre_style"></div>
<div id="backstage" class="theatre_style"></div>
<div id="markerdrop" class="theatre_style" ></div>
<div id="boundarydrop" class="theatre_style" ></div>
<div id="frontmarkerdrop" class="theatre_style">
	<div id="rotateCentre" class="rotation">
		<img alt="" src="assets/ccircle.png" />
	</div>
	<div id="rotateMove" class="rotation">
		<img alt="" src="assets/circle.png" />
	</div>
</div>

<!--dialogue box setting stage width and height-->
<div id='stagebox' class="dialoguebox">
	<div id='stagehead' class='head'>&nbsp; New Stage</div>
	<div id='stagecontent' class='content'>
		<p class="text_input">
			<label for="stagewidth">Width</label> <input type="text" name="stagewidth" id="stagewidth" value=1000 size=5 /><span>px</span>
		</p>
		<p class="text_input">
			<label for="stageheight">Height</label> <input type="text" name="stageheight" id="stageheight" value=500 size=5 /><span>px</span>
		</p>
		
		<input type="button" value=" OK " id="stageOK" onclick="setStage($('stagewidth').value,$('stageheight').value)" />
	</div>	
</div>

<!--dialogue box for colour picker-->
<div id='colorbox' class="dialoguebox">
  <div id='colorcontent' >
  	  <div id="coldigits" >
      	<div style="border: 1px solid black;height:50px;width:145px;top:0px;left:0px;">
        	<div id="quickColor"></div>
        	<div id="staticColor"></div>
      	</div>
      	<table style="position:absolute;top:55px; width:145px">
       	 <tr>
	          <td>Hex: </td>
    	      <td><input style="margin:0.3em;" size="8" type="text" id="hexBox" onChange="hexBoxChanged();" />
        	  </td>
	        </tr>
    	    <tr>
        	  <td>Red: </td>
	          <td><input style="margin:0.3em;" size="8" type="text" id="redBox" onChange="redBoxChanged();" />
	          </td>
    	    </tr>
        	<tr>
	          <td>Green: </td>
    	      <td><input style="margin:0.3em;" size="8" type="text" id="greenBox" onChange="greenBoxChanged();" />
        	  </td>
	        </tr>
	        <tr>
    	      <td>Blue: </td>
        	  <td><input style="margin:0.3em;" size="8" type="text" id="blueBox" onChange="blueBoxChanged();" />
	          </td>
    	    </tr>
        	<tr>
	          <td>Hue: </td>
	          <td><input style="margin:0.3em;" size="8" type="text" id="hueBox" onChange="hueBoxChanged();" />
    	      </td>
        	</tr>
	        <tr>
    	      <td>Saturation: </td>
        	  <td><input style="margin:0.3em;" size="8" type="text" id="saturationBox" onChange="saturationBoxChanged();" />
	          </td>
    	    </tr>
        	<tr>
	          <td>Value: </td>
    	      <td><input style="margin:0.3em;" size="8" type="text" id="valueBox" onChange="valueBoxChanged();" />
        	  </td>
	        </tr>
    	  </table>
    	  <div id="colvertline"><img alt="" id="colptr" src="assets/openpointer.png" style="position: absolute; top: 183px" onclick="colexpand()"/></div>
	    </div>
    <div id='colormask'></div>	
  
    <div id='colform' >
      <input type="button" id="OKbut" value="OK" onClick="setColor();closeColor()">
	  <input type="button" id="Applybut" value="Apply" onClick="setColor()">
      <input type="button" id="Cancel" value="Cancel" onClick="closeColor()">
    </div>
    <div id ='transpbox' >
      <div id='transptext'>Transparency 0%</div>
      <div id='transpimg'><img alt="" class='marker' id="check" src="assets/check.png" /> </div>
      <div id='transpslider'> </div>
      <div id='transpcover'> </div>
      <img alt="" class='marker' id="varrows" src="assets/transp_arrows.gif" /> </div>
    <div id="gradientBox" style=""> <img alt="" id="gradientImg" src="assets/color_picker_gradient.png" /> <img alt="" class='marker' id="circle" src="assets/color_picker_circle.gif" /> </div>
    <div id="hueBarDiv" style=""> <img alt="" class='marker' id='colorbar' src="assets/color_picker_bar.png" /> <img alt="" class='marker' id="arrows" src="assets/color_picker_arrows.gif" /> <br />
    </div>
  </div>
  <div id='colorhead' class="head">
    	<div id="colorheadtext">&nbsp; Line Colour</div>
    	<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"colorcontent")'/>
  </div>  
</div>

<!--dialogue box setting shadow effects-->
<div id='shadowbox' class="dialoguebox">
	<div id='shadowcontent' class='content'>
		<div id="shdirect">Move Shadow</div>
		<div id="shadowuparrow"><img alt="" id="shdirectup" src="assets/shup.png" /></div>
		<div id="shadowsidearrows"><img alt="" id="shdirectright" src="assets/shright.png" /><img alt="" id="shdirectleft" src="assets/shleft.png" /></div>
		<div id="shadowdownarrow"><img alt="" id="shdirectdown" src="assets/shdown.png" /></div>
		<div id="shblurtext">Blur Shadow</div>
		<div id="shblur"><img alt="" id="shslider" src="assets/transp_arrows.gif" /><img alt="" id="shblurline" src="assets/blur.png" /></div>
		<div style="top:165px; left:170px; background-color:transparent"><input type="button"  value="Cancel" onClick="closedialogue(this.parentNode)"></div>
	</div>
	<div id='shadowhead' class='head'>&nbsp; Shadow Effects
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"shadowcontent")'/>
	</div>
</div>

<!--dialogue box setting line weight-->
<div id='linebox' class="dialoguebox">
	<div id='linecontent' class='content'>
		<p class="text_input">
			<label for="linewidth">Width</label> <input type="text" name="linewidth" id="linewidth" value=1 size=5 /><span>px</span>
		</p>
		<p class="select_input">
			<label for="selectcap">Line Cap</label> 
			<select name="selectcap" id="selectcap" onchange="$('selectcapimg').src='assets/l'+$('selectcap').value+'.png'">
				<option value="butt" selected="selected">Butt</option>
				<option value="round">Round</option>
				<option value="square" >Square</option>
			</select>
			<img alt="" id="selectcapimg" src="assets/lbutt.png" />
		</p>
		<p class="select_input">
			<label for="selectjoin">Line Join</label> 
			<select name="selectjoin" id="selectjoin" onchange="$('selectjoinimg').src='assets/lj'+$('selectjoin').value+'.png'">
				<option value="bevel" >Bevel</option>
				<option value="miter" selected="selected">Miter</option>
				<option value="round" >Round</option>
			</select>
			<img alt="" id="selectjoinimg" src="assets/ljmiter.png" />
		</p>
		<br>
		<input type="button" value="OK" onClick="updateLines();closedialogue(this)">
	  	<input type="button" value="Apply" onClick="updateLines()()">
      	<input type="button"  value="Cancel" onClick="closedialogue(this)">
	</div>
	<div id='linehead' class='head'>&nbsp; Line Styles
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"linecontent")'/>
	</div>	
</div>

<!--dialogue box node types-->
<div id='pointsbox' class="dialoguebox">
	<div id='pointscontent' class='content'>
		<div id="p_points" class="notext">&nbsp;&nbsp;Points</div>
		<div id="p_corner" class="notext">&nbsp;&nbsp;Corner</div>
		<div id="p_smooth" class="notext">&nbsp;&nbsp;Smooth</div>
		<div id="p_inline" class="notext">&nbsp;&nbsp;In-line</div>
		<div id="p_delete" class="notext">&nbsp;&nbsp;Delete</div>
		<div id="p_open" class="notext">&nbsp;&nbsp;Open Path</div>
		<div id="p_segments" class="notext">&nbsp;&nbsp;<span style="color: #F09898">Seg</span><span style="color: #95B3D7">ments</span></div>
		<div id="p_line" class="notext">&nbsp;&nbsp;Curved</div><div id="p_line2"> </div>
		<div id="p_add" class="notext">&nbsp;&nbsp;Add Point</div><div id="p_add2"> </div>
		<div id="p_paths" class="notext">&nbsp;&nbsp;Path</div>
		<div id="p_close" class="notext">&nbsp;&nbsp;Close Path</div>
	</div>
	<div id='pointshead' class='head'>&nbsp; Edit
		<img alt="" src='assets/x.png' onclick='closedialogue(this);close_p_content();'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"pointscontent")'/>
	</div>
</div>

<!--dialogue box gradient fill settings-->
<div id='gradfillbox' class="dialoguebox">
	<div id='gradfillcontent' class='content'>
		<p class="chk_radio_input">
			 <input type="radio" name="gradfilltype" id="linear"  onchange="setlinear()" /><label for="linear">Linear Fill</label>
		</p>
		 <p class="chk_radio_input">
			 <input type="radio" name="gradfilltype" id="radial" onchange="setradial()" /><label for="radial">Radial Fill</label>
		</p>
		<input type="button" id="gAdd" value="Add Stop Point" onClick="addStop()"><br>
	  	<input type="button" id="gDel" value="Delete Stop Point" onClick="delStop()">
	</div>
	<div id='gradfillhead' class='head'>&nbsp; Colour Stops
		<img alt="" src='assets/x.png' onclick='closedialogue(this);closeStops();removeGradLine()'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"gradfillcontent")'/>
	</div>	
</div>

<!--dialogue box rotation value -->
<div id='rotatebox' class="dialoguebox">
	<div id='rotatecontent' class='content'>
		<p class="text_input">
			<label for="rotateangle">Angle</label> <input type="text" name="rotateangle" id="rotateangle" value=0 size=3 style="left:15px"/><span style="left:20px">&deg;</span>
		</p>
		<input type="button" value=" OK " id="rotateOK" onclick="updateangle($('rotateangle').value)" />
		<input type="button" value=" Close " id="rotateClose" onclick="closedialogue(this)" />
	</div>	
	<div id='rotatehead' class='head'>&nbsp; Rotate
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"rotatecontent")'/>
	</div>
</div>

<!--dialogue box name value-->
<div id='namebox' class="dialoguebox">
	<div id='namecontent' class='content'>
		<p class="text_input">
			<label for="shname">Name</label> <input type="text" name="shname" id="shname" value="" size=10 style="left:15px; text-align: left; "/>
		</p>
		<input type="button" value=" OK " onclick="updatename($('shname').value.trim());closedialogue(this)" />
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>	
	<div id='namehead' class='head'>&nbsp; Shape
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"namecontent")'/>
	</div>
</div>

<!--dialogue box grid settings-->
<div id='gridbox' class="dialoguebox">
	<div id='gridcontent' class='content'>
		<p class="chk_radio_input">
			Grid<br>
			 <input type="radio" name="gridonoff" id="gridon"  /><label for="gridon">On</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			 <input type="radio" name="gridonoff" id="gridoff" /><label for="gridoff">Off</label>
		</p>
		 <p class="chk_radio_input">
			 <input type="radio" name="gridshowhide" id="gridshow"  /><label for="gridshow">Show</label>&nbsp;&nbsp;
			 <input type="radio" name="gridshowhide" id="gridhide" /><label for="gridhide">Hide</label>
		</p>
		<p class="text_input">
			<label for="gridwidth">Width</label> <input type="text" name="gridwidth" id="gridwidth" value=30 size=5 /><span >pixels</span>
		</p>
		<p class="text_input">	
			<label for="gridheight">height</label> <input type="text" name="gridheight" id="gridheight" value=30 size=5 /><span >pixels</span>
		</p>
		<input type="button" value=" OK " onclick="updategrid()" />
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>
	<div id='gridhead' class='head'>&nbsp; Grid Settings
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"gridcontent")'/>
	</div>	
</div>

<!--dialogue from text box -->
<div id='fromtextbox' class="dialoguebox">
	<div id='fromtextcontent' class='content'>
		<p class="text_input">
			<label for="fromtext">Paste text from file into box below and click Create</label><br> <input type="textarea" name="fromtext" id="fromtext" value="" size=40 style="left:15px; text-align: left; "/>
		</p>
		<input type="button" value=" Create " onclick="extract($('fromtext').value.trim());closedialogue(this)" />
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>	
	<div id='fromtexthead' class='head'>&nbsp; Open File
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"fromtextcontent")'/>
	</div>
</div>

<!--dialogue file text box -->
<div id='filetextbox' class="dialoguebox">
	<div id='filetextcontent' class='content'>
		<div id="message">Drag Files into box below</div>
		<div id="drop_zone">
			
		</div>
		<div id="fileButtons">
			<input type="button" value=" Close " onclick="closedialogue(this.parentNode)" />
		</div>
	</div>	
	<div id='filetexthead' class='head'>&nbsp; Open Files
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"filetextcontent")'/>
	</div>
</div>

<!--Header bar ............................................................... -->
<div id="heading"><div id='msg' style='top:2px; left:750px; width:300px ;height:40px; '> </div>
 <div id='logo'><img alt="" src="assets/logo.png"></div>
  
  <div class="choice40" id='export'  onclick="$('fopts').style.visibility='visible'" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="To HTML" title="To HTML" src="assets/export.png"> </div>
  <div class='choice40' id='visit' onclick='visitgallery()' onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="Visit Gallery" title="Visit Gallery" src='assets/visit.png'> </div>
  <div class='choice40' id='help' onclick='openhelp()' onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img  alt="help" title="help" src='assets/help.png'> </div>	
  <input id="done" type="button" value="" onclick="closedone()" />
  <div id="fmbuttons">
  	<img film="" id="rewindfm" src="assets/startplay.png" onclick="rewindfilm(this.film)" alt="rewind" title="rewind" /> 
  	<img film="" id="playfm" src="assets/runplay.png" onclick="playfilm(this.film)" alt="play" title="play" /> 
  	<img film="" id="pausefm"  src="assets/pauseplay.png" onclick="pausefilm(this.film)"  alt="pause" title="pause" />
  	<img film="" id="playonfm" src="assets/runplay.png" onclick="playonfilm(this.film)"  alt="continue" title="continue" />
  	<img film="" id="stopfm"  src="assets/stopplay.png" onclick="stopfilm(this.film)"  alt="stop and close" title="stop and close" /> 
  </div>
  <div id="spbuttons">
  	<input sprite="" id="checksp" type="button" value="Track Check" onclick="checksprite(this.sprite,true)" /> 
  	<input sprite="" id="fullchecksp" type="button" value="Full Check" onclick="checksprite(this.sprite,false)" />
  	<input sprite="" id="savesp" type="button" value="Save Sprite" onclick="savesprite(this.sprite)" /> 
  </div>
  <input id="checkdone" type="button" value="Stop Check" onclick="STOPCHECKING=true;" />
  <div id='fopts'><a href='#' onClick="exportShapes();$('fopts').style.visibility='hidden' ;return false">Export Canvas to HTML</a><p><a href='#' onClick="writeFilm();$('fopts').style.visibility='hidden' ;return false">Export Film to HTML</a><p><a href='#' onClick="CanvasToText();$('fopts').style.visibility='hidden' ; return false;"><span id='ofas'>Export as TEXT</span></a></p><p><a href='#' onClick="fromText(); $('fopts').style.visibility='hidden' ;return false;"><span id='ifas'>Input File as Text</span></a></p></div>			
</div>

<!--toolbars ............................................................... -->
<div id='toolbar'>
  <div id='tlbrhead'> &nbsp; Tools </div>
  <div class="choice40" id='menushape'   onclick="showmenu()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="insert shapes" title="insert shapes" src="assets/menushapes.png"> </div>
  <div class="choice40" id='editlines'   onclick="markLine()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img  alt="edit lines" title="edit lines" src="assets/editlines.png"> </div>
  <div class="choice40" id='group'  onclick="groupJoin()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img alt="group shapes" title="group shapes" src="assets/group.png"> </div>
  <div class="choice40" id='ungroup'  onclick="ungroup()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img alt="ungroup shapes" title="ungroup shapes" src="assets/ungroup.png"> </div>
  <div class="choice40" id='stylelines' onclick="linestyles()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img alt="line styles" title="line styles" src="assets/stylelines.png"> </div>
  <div class="choice40" id='collines' onclick="linecolor()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="line colour" title="line colour" src="assets/collines.png"> </div>
  <div class="choice40" id='colfill' onclick="fillcolor()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="fill colour" title="fill colour" id='colimg' src="assets/colfill.png"> </div>
  <div class="choice40" id='gradfill'  onclick="gradfill()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="gradient fill" title="gradient fill" id='gradimg' src="assets/gradfill.png"> </div>
  <div class="choice40" id='rotate'  onclick="shaperotate()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="rotate" title="rotate" src="assets/rotate.png"> </div>
  <div class="choice40" id='front'  onclick="bringfront()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img alt="bring to front" title="bring to front" src="assets/front.png"> </div>
  <div class="choice40" id='back'  onclick="sendback()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="send to back" title="send to back" src="assets/back.png"> </div>
  <div class="choice40" id='grid'  onclick="setgrid()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="set grid" title="set grid" src="assets/grid.png"> </div>
  <div class="choice40" id='del'  onclick="shapedelete()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="delete" title="delete" src="assets/delete.png"> </div>
  <div class="choice40" id='copy'  onclick="shapecopy(10)" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="copy" title="copy" src="assets/copy.png"> </div>
  <div class="choice40" id='vert'  onclick="flipvert()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="flip vertical" title="flip vertical" src="assets/vert.png"> </div>
  <div class="choice40" id='horz'  onclick="fliphorz()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="flip horizontal" title="flip horizontal" src="assets/horz.png"> </div>
  <div class="choice40" id='alntop'  onclick="aligntop()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="align top" title="align top" src="assets/alntop.png"> </div>
  <div class="choice40" id='alnbot'  onclick="alignbot()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="align bottom" title="align bottom" src="assets/alnbot.png"> </div>
  <div class="choice40" id='alnleft'  onclick="alignleft()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="align left" title="align left" src="assets/alnleft.png"> </div>
  <div class="choice40" id='alnright'  onclick="alignright()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="align right" title="align right" src="assets/alnright.png"> </div>
  <div class="choice40" id='lundo'  onclick="undolast()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="undo delete" title="undo delete" src="assets/undo.png"> </div>	
  <div class="choice40" id='shadow'  onclick="shadow()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="shadow" title="shadow" src="assets/shadow.png"> </div>
  <div class="choice40" id='sname'  onclick="shapeName()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img alt="shape name" title="shape name" src="assets/shapename.png"> </div>
	
</div>

<!--element boxes ............................................................... -->
<div id='scenebox' class="elementsbox">
	<div id='scenecontent' class='allcontent'>
		<div class="leftbar"></div>
		<div id="rightbarsc" class="rightbar"></div>
		<div id="bottombarsc" class="bottombar"></div>
		<div id="rcornerbarsc" class="rcornerbar"></div>
		<div id="innersc" class="inner"></div>
	</div>
	<div class="white"></div>
	<div class="newbuild40" onmouseover="this.className='newbuild80'" onmouseout="this.className='newbuild40'" onclick="scbb()"><span class="buildhead">Build New</span></div>	
	<div class="lbar"></div>
	<div class="rbar"></div>
	<div class="bbar"></div>
	<div id='scenehead' class='head'>&nbsp; Scenery
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"scenecontent")'/>
	</div>
</div>

<div id='spritebox' class="elementsbox">
	<div id='spritecontent' class='allcontent'>
		<div class="leftbar"></div>
		<div id="rightbarsp" class="rightbar"></div>
		<div id="bottombarsp" class="bottombar"></div>
		<div id="rcornerbarsp" class="rcornerbar"></div>
		<div id="innersp" class="inner" path=""></div>
	</div>
	<div class="white"></div>
	<div class="newbuild40" onmouseover="this.className='newbuild80'" onmouseout="this.className='newbuild40'" onclick="spbb()"><span class="buildhead">Build New</span></div>	
	<div class="lbar"></div>
	<div class="rbar"></div>
	<div class="bbar"></div>
	<div id='spritehead' class='head'>&nbsp; Sprites
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"spritecontent")'/>
	</div>
</div>

<div id='tweenbox' class="elementsbox">
	<div id='tweencontent' class='allcontent'>
		<div class="leftbar"></div>
		<div id="rightbartw" class="rightbar"></div>
		<div id="bottombartw" class="bottombar"></div>
		<div id="rcornerbartw" class="rcornerbar"></div>
	</div>
	<div class="white"></div>
	<div class="newbuild40" onmouseover="this.className='newbuild80'" onmouseout="this.className='newbuild40'" onclick="$('tweenbuildbox').style.visibility='visible'"><span class="buildhead">Build New</span></div>	
	<div class="lbar"></div>
	<div class="rbar"></div>
	<div class="bbar"></div>
	<div id='tweenhead' class='head'>&nbsp; Tweens
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"tweencontent")'/>
	</div>
</div>

<div id='trackbox' class="elementsbox">
	<div id='trackcontent' class='allcontent'>
		<div class="leftbar"></div>
		<div id="rightbartr" class="rightbar"></div>
		<div id="bottombartr" class="bottombar"></div>
		<div id="rcornerbartr" class="rcornerbar"></div>
		<div id="innertr" class="inner" path=""></div>
	</div>
	<div class="white"></div>
	<div class="newbuild40" onmouseover="this.className='newbuild80'" onmouseout="this.className='newbuild40'" onclick="trbb()"><span class="buildhead">Build New</span></div>	
	<div class="lbar"></div>
	<div class="rbar"></div>
	<div class="bbar"></div>
	<div id='trackhead' class='head'>&nbsp; Tracks
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"trackcontent")'/>
	</div>
</div>

<div id='filmbox' class="elementsbox">
	<div id='filmcontent' class='allcontent'>
		<div class="leftbar"></div>
		<div id="rightbarfm" class="rightbar"></div>
		<div id="bottombarfm" class="bottombar"></div>
		<div id="rcornerbarfm" class="rcornerbar"></div>
		<div id="innerfl" class="inner" path=""></div>
	</div>
	<div class="white"></div>
	<div class="newbuild40" onmouseover="this.className='newbuild80'" onmouseout="this.className='newbuild40'" onclick="flbb()"><span class="buildhead">Build New</span></div>	
	<div class="lbar"></div>
	<div class="rbar"></div>
	<div class="bbar"></div>
	<div id='filmhead' class='head'>&nbsp; Films
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"filmcontent")'/>
	</div>
</div>

<div id='listshapebox'>
	<div id='listshapecontent'>
		<div class="leftbar"></div>
		<div class="topbar"></div>
		<div id="rightbarls" class="rightbar"></div>
		<div id="bottombarls" class="bottombar"></div>
		<div id="rcornerbarls" class="rcornerbar"></div>
		<div id="innerls" class="inner"></div>
	</div>
</div>

<!--build draggable ............................................................... -->

<div id="dragdiv" class="dragger"></div>

<!--build builder dialogues ............................................................... -->
<div id='scenebuildbox' class="dialoguebox">
	<div id='scenebuildcontent' class='content'>
		From
		<p class="chk_radio_input">
			<input type="radio" name="scbld" id="scblank"  /><label for="scblank">Blank</label><br>
			<input type="radio" name="scbld" id="sccanvas" /><label for="sccanvas">Current Canvas</label><br>
			<input type="radio" name="scbld" id="scsel" /><label for="sccanvas">Selection</label>
		</p>
		<p class="text_input">
			<label for="scenetitle">Title</label> <input class="title" type="text" name="scenetitle" id="scenetitle" size=15 />
		</p>
		<input type="button" value=" OK " onclick="buildScene()" />
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>
	<div id='scenebuildhead' class='head'><span>&nbsp; Build Scenery</span>
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"scenebuildcontent")'/>
	</div>	
</div>

<div id='trackbuildbox' class="dialoguebox">
	<div id='trackbuildcontent' class='content'>
		<p class"=justtext" id="tracktext">
			&nbsp;&nbsp;Select just one shape.
		</p>
		<p class="text_input">
			<label for="tracktitle">Title</label> <input class="title" type="text" name="tracktitle" id="tracktitle" size=15 />
		</p>
		<p class="text_input">
			<label for="trackreps">Repetitions.</label><input type=text id="trackreps" value="0" size=7>
		</p>
		<p class="check_input">
			<input type="checkbox" id="yoyo"><label for="yoyo">Yoyo.</label>
		</p>
		<p class="check_input">
			<input type="checkbox" id="viewselect"><label for="viewselect">Visible.</label>
		</p>
		<input type="button" value=" OK " onclick="buildTrack()" />
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>
	<div id='trackbuildhead' class='head'>&nbsp; Build A Track
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"trackbuildcontent")'/>
	</div>	
</div>

<div id='spritebuildbox' class="dialoguebox">
	<div id='spritebuildcontent' class='content'>
		<div id="spritediv" >
			<div id="spritedropel">Element</div><div id="spritedroptrack">Track</div>
			<div id="eldrop" source=""></div><div id="trackdrop"></div>
		</div>
		<div id="spritechoice">
		<p class="text_input">
			<label for="spritetitle">Title</label> <input class="title" type="text" name="spritetitle" id="spritetitle" size=15 />
		</p>
		<p class="text_input">
			<label for="spritetime">Time over path.</label><input type=text id="spritetime" value="5" size=5><span>Secs.</span>
		</p>
		<p class="check_input">
			<input type="checkbox" id="spritevector"><label for="spritevector">Position by Vector.</label>
		</p>
		<input type="button" value=" OK " onclick="buildSprite()" />
		<input type="button" value=" Close " onclick="closedialogue(this.parentNode)" />
		</div>
	</div>
	<div id='spritebuildhead' class='head'>&nbsp; Build A Sprite
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"spritebuildcontent")'/>
	</div>	
</div>

<div id='filmbuildbox' class="elementsbox">
	<div id='filmbuildcontent'class='allcontent'>
		<div id="viewport">
			<div id="filmbuildstory">
				<div id="filmbuildlines">
					<div id="timeline"></div>
				</div>
				<div id="filmbuildboard" source=""></div>
		 	</div>	
		</div>
		
		<div id="scrollrightmask"></div>
		<div id="scrollbottommask"></div>
		<div id="scrollrightholder" class="out20" onmouseover="this.className='in100'" onmouseout="this.className='out20'">
			<img id="scup" src="assets/scupin.png" />
			<div id="scrollud" class="scrollbar"></div>
			<img id="scdw" src="assets/scdwin.png" />
		</div>
		<div id="scrollbottomholder" class="out20" onmouseover="this.className='in100'" onmouseout="this.className='out20'">
			<img id="sclf" src="assets/sclfin.png" />
			<div id="scrolllr" class="scrollbar"></div>
			<img id="scrt" src="assets/scrtin.png" />
		</div>
				<div id="flellistholder">
			<div id="flellist"></div>
		</div>
		<div id="flelorder"><span class="arr" onclick="flelup()">&#11014;</span >&nbsp;&nbsp;&nbsp;&nbsp; <span class="arr" onclick="fleldown()">&#11015;</span></div>
		<div id="scrollcorner"></div>
		<div class="leftbar"></div>
		<div id="rightbarfl" class="rightbar"></div>
		<div id="bottombarfl" class="bottombar"></div>
		<div id="rcornerbarfl" class="rcornerbar"></div>
		
	</div>
	<div class="white"></div>
	
	<div class="filmline"><label for="filmtitle"> &nbsp;Title</label> <input class="title" type="text" name="filmtitle" id="filmtitle" size=15 /> 
		<input type="button" value=" Save " onclick="buildFilm(this)" />
		<input type="button" value=" Cancel " onclick="cancelFilmBuild(this)" />
	</div>
	<div id="currentel" class="current"> &nbsp;Current Element:</div>
	<div class="sclbar"></div>		
	<div class="scrbar"></div>
	<div class="bbar"></div>
	<div id='filmbuildhead' class='head'>&nbsp; Build A Film
		<img alt="" src='assets/x.png' onclick='cancelFilmBuild(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"filmbuildcontent")'/>
	</div>	
</div>

<!--edit dialogues ............................................................... -->
<div id='sceneeditbox' class="dialoguebox">
	<div id='sceneeditcontent' class='content'>
		<p id="scpath" class="pathtext"></p>
		<p class="text_input">
			<label for="editscenetitle">Title</label> <input class="title" type="text" name="editscenetitle" id="editscenetitle" size=15 onclick="$('scbutton').style.visibility='inherit'"/>
		</p>
		<input type="button" value=" Change Name " id="scbutton" OKname="" onclick="editScene(this)" style="visibility:hidden"/>
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>
	<div id='sceneedithead' class='head'><span>&nbsp; Edit Scenery</span>
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"sceneeditcontent")'/>
	</div>	
</div>

<div id='trackeditbox' class="dialoguebox">
	<div id='trackeditcontent' class='content'>
		<p id="trpath" class="pathtext"></p>
		<p class="text_input">
			<label for="edittracktitle">Title</label> <input class="title" type="text" name="edittracktitle" id="edittracktitle" size=15 onclick="$('trbutton').style.visibility='inherit'" />
		</p>
		<p class="text_input">
			<label for="edittrackreps">Repetitions.</label><input type=text id="edittrackreps" value="0" size=7 onclick="$('trbutton').style.visibility='inherit'" />
		</p>
		<p class="check_input">
			<input type="checkbox" id="edityoyo" onclick="$('trbutton').style.visibility='inherit'"><label for="edityoyo">Yoyo.</label>
		</p>
		<p class="check_input">
			<input type="checkbox" id="editviewselect" onclick="$('trbutton').style.visibility='inherit'"><label for="editviewselect">Visible.</label>
		</p>
		<input type="button" id="trbutton" value=" Change " onclick="editTrack(this)" OKname="" />
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>
	<div id='trackedithead' class='head'>&nbsp; Edit A Track
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"trackeditcontent")'/>
	</div>	
</div>

<div id='spriteeditbox' class="dialoguebox">
	<div id='spriteeditcontent' class='content'>
		<p id="sppath" class="pathtext"></p>
		<p class="text_input">
			<label for="editspritetitle">Title</label> <input class="title" type="text" name="editspritetitle" id="editspritetitle" size=15 onclick="$('spbutton').style.visibility='inherit'" />
		</p>
		<p class="text_input">
			<label for="editspritetime">Time over path.</label><input type=text id="editspritetime" value="5" size=5 onclick="$('spbutton').style.visibility='inherit'" ><span>Secs.</span>
		</p>
		<p class="check_input">
			<input type="checkbox" id="editspritevector" onclick="$('spbutton').style.visibility='inherit'" ><label for="editspritevector">Position by Vector.</label>
		</p>
		<input type="button" id="spbutton" value=" Change " onclick="editSprite(this)" OKname=""/>
		<input type="button" value=" Close " onclick="closedialogue(this)" />
	</div>
	<div id='spriteedithead' class='head'>&nbsp; Edit A Sprite
		<img alt="" src='assets/x.png' onclick='closedialogue(this)'/>
    	<img alt="" src='assets/up.png' onclick='updialogue(this,"spriteeditcontent")'/>
	</div>	
</div>



<!--animation toolbar ............................................................... -->
<div id='anibar'>
  <div id='anibarhd'>Elements</div>
  
   <div id='anicontent'>
		<div id='aniscene' class="choice40" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'" onClick="anidialogue('scene')">&nbsp;&nbsp;Scenery </div>
		<div id='anisprite' class="choice40" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'" onClick="anidialogue('sprite')">&nbsp;&nbsp;Sprites </div>
		<div id='anitween' class="choice40" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'" onClick="anidialogue('tween')">&nbsp;&nbsp;Tweens </div>
		<div id='anifilm' class="choice40" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'" onClick="anidialogue('film')">&nbsp;&nbsp;Films </div>
		<div id='anitrack' class="choice40" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'" onClick="anidialogue('track')">&nbsp;&nbsp;Tracks </div>
   </div>
</div>

<!--vectors for track ............................................................... -->
<div id='vecdiv'>
  
  <canvas id='vecanv'></canvas>
  <div id='vecrotate' ><canvas id='vecircdiv'></canvas></div>
</div>
<div id='spritecentre'>
	<canvas id='spritemidiv'></canvas>
</div> 
</body>
</html>
